% test models
clear all
addpath ../analysis/matlab

% load some data to compare model to
load ../analysis/matlab/MCMC_all_clean

% simulate model for each run for each participant
for cond = 1:1 % condition number
    for run = 1:1 % run number
        for subj = 1:18 % subject number
            
            % model parameters
            beta = .1;
            q = 0.8;
            
            V = data.values{subj,run,cond};
            sim = bandit_mcmc(V,beta,q);
            sim_mcmc{cond}(subj,run) = process_data(sim);
            
            sim = bandit_mcmc_prior(V,beta,[q 60]);
            sim_mcmc_prior{cond}(subj,run) = process_data(sim);
            
            mcmc_all.p_stick(subj,:,run,cond) = sim_mcmc{cond}(subj,run).p_stick;
            mcmc_all.ar(subj,:,run,cond) = sim_mcmc{cond}(subj,run).ar;
            
            mcmc_prior_all.p_stick(subj,:,run,cond) = sim_mcmc_prior{cond}(subj,run).p_stick;
            mcmc_prior_all.ar(subj,:,run,cond) = sim_mcmc_prior{cond}(subj,run).ar;
            
        end
    end
end

%% aggregate
simAv_blocks.p_stick = squeeze(nanmean(sim_mcmc.p_stick,3));
simAv_blocks.ar = squeeze(nanmean(sim_.ar,3));
simAv_blocks.r_av = squeeze(nanmean(data.r_av,3));
simAv_blocks.r = squeeze(nanmean(data.r,3));


simAv_subj.p_stick = squeeze(nanmean(dAv_blocks.p_stick,1));
simAv_subj.r_av = squeeze(nanmean(dAv_blocks.r_av,1));
simAv_subj.r = squeeze(nanmean(dAv_blocks.r,1));
simAv_subj.ar = squeeze(nanmean(dAv_blocks.ar,1));
        
%%

subj = 1;
cond = 1;
run = 1;
% plot result
fhandle = figure(1); clf; hold on
set(fhandle, 'Position', [200, 100, 900, 500]); % set size and loction on screen
set(fhandle, 'Color','w') % set background color to white
    
subplot(1,2,1); hold on
plot(data.p_stick(subj,:,run,cond),'k','linewidth',2)
plot(mcmc_all.p_stick,'r')
plot(mcmc_prior_all.p_stick,'g')

subplot(1,2,2); hold on
plot(data.ar(subj,:,run,cond),'k','linewidth',2)
plot(mcmc_all.ar,'r','linewidth',2)
plot(mcmc_prior_all.ar,'g','linewidth',2)